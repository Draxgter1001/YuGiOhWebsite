spring.application.name=yugioh-scanner

# ============================================
# Heroku / Server Configuration
# ============================================
# Heroku assigns a dynamic port via $PORT. Fallback to 8080 for local dev.
server.port=${PORT:8080}
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json,image/jpeg,image/png

# ============================================
# Database Configuration
# ============================================
spring.datasource.url=${JDBC_DATABASE_URL:${POSTGRES_DATABASE_URL}}
spring.datasource.username=${POSTGRES_USERNAME}
spring.datasource.password=${POSTGRES_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate
# SECURITY: Use 'validate' in production to prevent accidental schema deletion/modification.
# Use 'update' only locally.
spring.jpa.hibernate.ddl-auto=${DDL_AUTO:validate}
spring.jpa.show-sql=${SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=${SHOW_SQL:false}
spring.jpa.open-in-view=false

# Optimization
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.connection.provider_class=org.hibernate.hikaricp.internal.HikariCPConnectionProvider

# Connection Pool (Optimized for Heroku Basic/Standard Dynos)
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=30000

# ============================================
# File Upload & Python
# ============================================
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
app.upload.temp.dir=${TEMP_DIR:/tmp/yugioh-uploads}


app.python.ocr.url=https://mindyugioh-yugiohocr.hf.space

# ============================================
# External APIs
# ============================================
yugioh.api.base.url=https://db.ygoprodeck.com/api/v7/cardinfo.php

# ============================================
# JWT & Security
# ============================================
jwt.secret=${JWT_SECRET}
jwt.access-token-expiration=900000
jwt.refresh-token-expiration=604800000

# CORS (Comma separated list of allowed origins)
app.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000}

# Backend URL (used for image URLs in API responses)
# Set BACKEND_URL env var in production (e.g., https://your-app.herokuapp.com)
app.backend.url=${BACKEND_URL:http://localhost:8080}

# ============================================
# Email
# ============================================
spring.mail.host=${MAIL_HOST:smtp.gmail.com}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME}
spring.mail.password=${MAIL_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
app.frontend.url=${FRONTEND_URL}

# ============================================
# Deployment / Proxy Configuration
# ============================================
# Critical for Heroku: tells Spring it's running behind a load balancer (Heroku Router)
server.forward-headers-strategy=native

# ============================================
# Performance Optimization (Caching)
# ============================================
spring.cache.type=caffeine
# 'card_api_data': Caches responses from YGOProDeck
spring.cache.cache-names=card_api_data
# Expire entries after 24 hours to keep data fresh but fast
spring.cache.caffeine.spec=expireAfterWrite=24h,maximumSize=1000